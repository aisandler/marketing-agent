<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A/B Testing Dashboard - Marketing Engine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .dashboard-content {
            padding: 30px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-button {
            padding: 12px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .control-button:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .control-button.success {
            background: #27ae60;
        }

        .control-button.success:hover {
            background: #229954;
        }

        .control-button.danger {
            background: #e74c3c;
        }

        .control-button.danger:hover {
            background: #c0392b;
        }

        .control-button.secondary {
            background: #95a5a6;
        }

        .control-button.secondary:hover {
            background: #7f8c8d;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ecf0f1;
            margin-bottom: 30px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #7f8c8d;
        }

        .tab.active {
            border-bottom-color: #3498db;
            color: #2c3e50;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .test-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 5px solid #3498db;
            transition: all 0.3s ease;
        }

        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .test-card.running {
            border-left-color: #27ae60;
        }

        .test-card.stopped {
            border-left-color: #e74c3c;
        }

        .test-card.paused {
            border-left-color: #f39c12;
        }

        .test-card.draft {
            border-left-color: #95a5a6;
        }

        .test-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .test-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .test-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .status-running {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-stopped {
            background: #fadbd8;
            color: #e74c3c;
        }

        .status-paused {
            background: #fef5e7;
            color: #f39c12;
        }

        .status-draft {
            background: #e8f4f8;
            color: #3498db;
        }

        .test-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .metric-value {
            font-size: 2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .test-progress {
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9em;
            color: #7f8c8d;
            text-align: center;
        }

        .variant-results {
            margin-bottom: 20px;
        }

        .variant-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .variant-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .variant-rate {
            font-size: 1.2em;
            font-weight: 700;
            color: #3498db;
        }

        .variant-winner {
            background: #d5f4e6;
            border-left: 4px solid #27ae60;
        }

        .test-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            background: white;
        }

        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            min-height: 100px;
            resize: vertical;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1em;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .dashboard-content {
                padding: 20px;
            }

            .test-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .controls {
                flex-direction: column;
            }

            .header h1 {
                font-size: 2em;
            }

            .test-metrics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ A/B Testing Dashboard</h1>
            <p>Create, manage, and analyze content experiments</p>
        </div>

        <div class="dashboard-content">
            <div class="controls">
                <button class="control-button success" onclick="openCreateTestModal()">
                    ‚ûï Create New Test
                </button>
                <button class="control-button" onclick="refreshData()">
                    üîÑ Refresh Data
                </button>
                <button class="control-button secondary" onclick="viewTestHistory()">
                    üìä View History
                </button>
                <button class="control-button secondary" onclick="exportResults()">
                    üì• Export Results
                </button>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('overview')">Overview</div>
                <div class="tab" onclick="switchTab('active-tests')">Active Tests</div>
                <div class="tab" onclick="switchTab('completed')">Completed Tests</div>
                <div class="tab" onclick="switchTab('analytics')">Analytics</div>
            </div>

            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content active">
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="total-tests">0</div>
                        <div class="stat-label">Total Tests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="active-tests">0</div>
                        <div class="stat-label">Active Tests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-improvement">0%</div>
                        <div class="stat-label">Avg Improvement</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="significant-tests">0</div>
                        <div class="stat-label">Significant Results</div>
                    </div>
                </div>

                <h3>Recent Tests</h3>
                <div id="recent-tests" class="test-grid">
                    <!-- Recent tests will be populated here -->
                </div>
            </div>

            <!-- Active Tests Tab -->
            <div id="active-tests-tab" class="tab-content">
                <div id="active-tests-grid" class="test-grid">
                    <!-- Active tests will be populated here -->
                </div>
            </div>

            <!-- Completed Tests Tab -->
            <div id="completed-tab" class="tab-content">
                <div id="completed-tests-grid" class="test-grid">
                    <!-- Completed tests will be populated here -->
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics-tab" class="tab-content">
                <h3>Performance Analytics</h3>
                <div id="analytics-content">
                    <div class="no-data">
                        <h3>Analytics Coming Soon</h3>
                        <p>Advanced analytics and trend analysis will be available here.</p>
                    </div>
                </div>
            </div>

            <div id="loading-indicator" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Loading A/B testing data...</p>
            </div>

            <div id="no-data-message" class="no-data" style="display: none;">
                <h3>No A/B Tests Found</h3>
                <p>Create your first A/B test to start optimizing your content.</p>
                <button class="control-button success" onclick="openCreateTestModal()">
                    Create Your First Test
                </button>
            </div>
        </div>
    </div>

    <!-- Create Test Modal -->
    <div id="create-test-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New A/B Test</h2>
                <span class="close" onclick="closeCreateTestModal()">&times;</span>
            </div>
            <form id="create-test-form">
                <div class="form-group">
                    <label class="form-label">Test Name</label>
                    <input type="text" class="form-input" id="test-name" placeholder="Enter test name" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Test Type</label>
                    <select class="form-select" id="test-type" required onchange="updateTestTypeDescription()">
                        <option value="">Select test type</option>
                        <option value="headline_testing">Headline Testing</option>
                        <option value="cta_testing">CTA Testing</option>
                        <option value="content_length">Content Length</option>
                        <option value="tone_variations">Tone Variations</option>
                        <option value="email_subject_lines">Email Subject Lines</option>
                        <option value="social_media_posts">Social Media Posts</option>
                    </select>
                    <p id="test-type-description" style="margin-top: 8px; color: #7f8c8d; font-size: 0.9em;"></p>
                </div>

                <div class="form-group">
                    <label class="form-label">Hypothesis</label>
                    <textarea class="form-textarea" id="test-hypothesis" placeholder="Describe what you expect to happen and why" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Base Content</label>
                    <textarea class="form-textarea" id="base-content" placeholder="Enter the original content to test variations against" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Test Duration (days)</label>
                    <input type="number" class="form-input" id="test-duration" value="14" min="1" max="90" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Sample Size</label>
                    <input type="number" class="form-input" id="sample-size" value="1000" min="100" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Success Metrics</label>
                    <input type="text" class="form-input" id="success-metrics" placeholder="e.g., click_through_rate, conversion_rate" required>
                </div>

                <div style="text-align: right; margin-top: 30px;">
                    <button type="button" class="control-button secondary" onclick="closeCreateTestModal()">Cancel</button>
                    <button type="submit" class="control-button success" style="margin-left: 10px;">Create Test</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Test Details Modal -->
    <div id="test-details-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="test-details-title">Test Details</h2>
                <span class="close" onclick="closeTestDetailsModal()">&times;</span>
            </div>
            <div id="test-details-content">
                <!-- Test details will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let tests = [];
        let currentTest = null;
        let currentTab = 'overview';

        // Test type descriptions
        const testTypeDescriptions = {
            headline_testing: 'Test different headlines for effectiveness using emotional, rational, urgency, or curiosity approaches',
            cta_testing: 'Test call-to-action buttons and text with variations in action words, colors, positioning, and urgency',
            content_length: 'Test different content lengths: short, medium, long, or comprehensive formats',
            tone_variations: 'Test different brand voice tones: professional, friendly, authoritative, or conversational',
            email_subject_lines: 'Test email subject line effectiveness with personalized, question-based, benefit-focused, or urgency approaches',
            social_media_posts: 'Test social media content variations in image style, caption length, hashtag strategy, or posting time'
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadTestData();
        });

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');

            currentTab = tabName;
            populateTabContent(tabName);
        }

        // Load test data
        async function loadTestData() {
            showLoading();

            try {
                // In a real implementation, this would fetch from the API
                const response = await simulateAPICall('/api/ab-tests');
                tests = response.tests || [];

                if (tests.length === 0) {
                    showNoData();
                } else {
                    hideLoading();
                    updateSummaryStats();
                    populateTabContent(currentTab);
                }
            } catch (error) {
                console.error('Error loading test data:', error);
                showNoData();
            }
        }

        // Update summary statistics
        function updateSummaryStats() {
            const activeTests = tests.filter(t => t.status === 'running').length;
            const completedTests = tests.filter(t => t.status === 'stopped').length;

            // Calculate average improvement for significant tests
            const significantTests = tests.filter(t => t.results && t.results.statistical_significance);
            const avgImprovement = significantTests.length > 0
                ? (significantTests.reduce((sum, t) => sum + (t.results.lift_percentage || 0), 0) / significantTests.length).toFixed(1)
                : 0;

            document.getElementById('total-tests').textContent = tests.length;
            document.getElementById('active-tests').textContent = activeTests;
            document.getElementById('avg-improvement').textContent = avgImprovement + '%';
            document.getElementById('significant-tests').textContent = significantTests.length;
        }

        // Populate tab content
        function populateTabContent(tabName) {
            switch (tabName) {
                case 'overview':
                    populateRecentTests();
                    break;
                case 'active-tests':
                    populateActiveTests();
                    break;
                case 'completed':
                    populateCompletedTests();
                    break;
                case 'analytics':
                    populateAnalytics();
                    break;
            }
        }

        // Populate recent tests
        function populateRecentTests() {
            const container = document.getElementById('recent-tests');
            const recentTests = tests.slice(0, 6); // Show 6 most recent

            if (recentTests.length === 0) {
                container.innerHTML = '<div class="no-data"><p>No tests available</p></div>';
                return;
            }

            container.innerHTML = recentTests.map(test => createTestCard(test)).join('');
        }

        // Populate active tests
        function populateActiveTests() {
            const container = document.getElementById('active-tests-grid');
            const activeTests = tests.filter(t => t.status === 'running' || t.status === 'paused');

            if (activeTests.length === 0) {
                container.innerHTML = '<div class="no-data"><p>No active tests</p></div>';
                return;
            }

            container.innerHTML = activeTests.map(test => createTestCard(test)).join('');
        }

        // Populate completed tests
        function populateCompletedTests() {
            const container = document.getElementById('completed-tests-grid');
            const completedTests = tests.filter(t => t.status === 'stopped');

            if (completedTests.length === 0) {
                container.innerHTML = '<div class="no-data"><p>No completed tests</p></div>';
                return;
            }

            container.innerHTML = completedTests.map(test => createTestCard(test)).join('');
        }

        // Create test card HTML
        function createTestCard(test) {
            const statusClass = test.status.replace('_', '-');
            const progress = calculateProgress(test);
            const variants = test.variants || [];

            return `
                <div class="test-card ${statusClass}">
                    <div class="test-header">
                        <div>
                            <div class="test-title">${test.name}</div>
                            <span class="test-status status-${statusClass}">${test.status}</span>
                        </div>
                    </div>

                    <div class="test-metrics">
                        <div class="metric">
                            <div class="metric-value">${test.tracking ? test.tracking.total_impressions : 0}</div>
                            <div class="metric-label">Impressions</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${test.tracking ? test.tracking.total_conversions : 0}</div>
                            <div class="metric-label">Conversions</div>
                        </div>
                    </div>

                    ${test.status === 'running' || test.status === 'paused' ? `
                        <div class="test-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-text">${progress}% Complete</div>
                        </div>
                    ` : ''}

                    ${test.results && test.results.winner ? `
                        <div class="variant-results">
                            <div class="variant-item variant-winner">
                                <span class="variant-name">üèÜ ${test.results.winner.variant_name}</span>
                                <span class="variant-rate">${test.results.winner.conversion_rate.toFixed(2)}%</span>
                            </div>
                        </div>
                    ` : ''}

                    <div class="test-actions">
                        <button class="action-btn btn-primary" onclick="viewTestDetails('${test.id}')">
                            View Details
                        </button>
                        ${getActionButtons(test)}
                    </div>
                </div>
            `;
        }

        // Get action buttons based on test status
        function getActionButtons(test) {
            switch (test.status) {
                case 'draft':
                    return `
                        <button class="action-btn btn-success" onclick="startTest('${test.id}')">Start Test</button>
                        <button class="action-btn btn-secondary" onclick="editTest('${test.id}')">Edit</button>
                    `;
                case 'running':
                    return `
                        <button class="action-btn btn-warning" onclick="pauseTest('${test.id}')">Pause</button>
                        <button class="action-btn btn-danger" onclick="stopTest('${test.id}')">Stop</button>
                    `;
                case 'paused':
                    return `
                        <button class="action-btn btn-success" onclick="resumeTest('${test.id}')">Resume</button>
                        <button class="action-btn btn-danger" onclick="stopTest('${test.id}')">Stop</button>
                    `;
                case 'stopped':
                    return `
                        <button class="action-btn btn-secondary" onclick="cloneTest('${test.id}')">Clone</button>
                        <button class="action-btn btn-secondary" onclick="archiveTest('${test.id}')">Archive</button>
                    `;
                default:
                    return '';
            }
        }

        // Calculate test progress
        function calculateProgress(test) {
            if (!test.configuration || !test.tracking) return 0;

            const targetSample = test.configuration.sample_size;
            const currentSample = test.tracking.total_impressions;

            return Math.min(100, Math.round((currentSample / targetSample) * 100));
        }

        // Modal functions
        function openCreateTestModal() {
            document.getElementById('create-test-modal').style.display = 'block';
        }

        function closeCreateTestModal() {
            document.getElementById('create-test-modal').style.display = 'none';
            document.getElementById('create-test-form').reset();
        }

        function updateTestTypeDescription() {
            const testType = document.getElementById('test-type').value;
            const description = testTypeDescriptions[testType] || '';
            document.getElementById('test-type-description').textContent = description;
        }

        // Test management functions
        async function startTest(testId) {
            try {
                await simulateAPICall(`/api/ab-tests/${testId}/start`, 'POST');
                await loadTestData();
                alert('Test started successfully!');
            } catch (error) {
                alert('Error starting test: ' + error.message);
            }
        }

        async function stopTest(testId) {
            if (!confirm('Are you sure you want to stop this test?')) return;

            try {
                await simulateAPICall(`/api/ab-tests/${testId}/stop`, 'POST');
                await loadTestData();
                alert('Test stopped successfully!');
            } catch (error) {
                alert('Error stopping test: ' + error.message);
            }
        }

        async function pauseTest(testId) {
            try {
                await simulateAPICall(`/api/ab-tests/${testId}/pause`, 'POST');
                await loadTestData();
                alert('Test paused successfully!');
            } catch (error) {
                alert('Error pausing test: ' + error.message);
            }
        }

        async function resumeTest(testId) {
            try {
                await simulateAPICall(`/api/ab-tests/${testId}/resume`, 'POST');
                await loadTestData();
                alert('Test resumed successfully!');
            } catch (error) {
                alert('Error resuming test: ' + error.message);
            }
        }

        // Create test form submission
        document.getElementById('create-test-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                name: document.getElementById('test-name').value,
                type: document.getElementById('test-type').value,
                hypothesis: document.getElementById('test-hypothesis').value,
                base_content: document.getElementById('base-content').value,
                duration: parseInt(document.getElementById('test-duration').value),
                sample_size: parseInt(document.getElementById('sample-size').value),
                metrics: document.getElementById('success-metrics').value.split(',').map(m => m.trim())
            };

            try {
                await simulateAPICall('/api/ab-tests', 'POST', formData);
                closeCreateTestModal();
                await loadTestData();
                alert('Test created successfully!');
            } catch (error) {
                alert('Error creating test: ' + error.message);
            }
        });

        // View test details
        function viewTestDetails(testId) {
            const test = tests.find(t => t.id === testId);
            if (!test) return;

            document.getElementById('test-details-title').textContent = test.name;
            document.getElementById('test-details-content').innerHTML = createTestDetailsHTML(test);
            document.getElementById('test-details-modal').style.display = 'block';
        }

        function closeTestDetailsModal() {
            document.getElementById('test-details-modal').style.display = 'none';
        }

        // Create test details HTML
        function createTestDetailsHTML(test) {
            return `
                <div style="margin-bottom: 20px;">
                    <h3>Test Information</h3>
                    <p><strong>Type:</strong> ${test.type}</p>
                    <p><strong>Status:</strong> ${test.status}</p>
                    <p><strong>Hypothesis:</strong> ${test.hypothesis || 'Not specified'}</p>
                    <p><strong>Created:</strong> ${new Date(test.created_at).toLocaleDateString()}</p>
                </div>

                ${test.results ? `
                    <div style="margin-bottom: 20px;">
                        <h3>Results</h3>
                        <p><strong>Statistical Significance:</strong> ${test.results.statistical_significance ? 'Yes' : 'No'}</p>
                        <p><strong>Confidence Level:</strong> ${test.results.confidence_level}%</p>
                        ${test.results.winner ? `<p><strong>Winner:</strong> ${test.results.winner.variant_name}</p>` : ''}
                        ${test.results.lift_percentage ? `<p><strong>Improvement:</strong> ${test.results.lift_percentage.toFixed(2)}%</p>` : ''}
                    </div>
                ` : ''}

                <div>
                    <h3>Variants</h3>
                    ${(test.variants || []).map(variant => `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <strong>${variant.name}</strong>
                            <p style="margin-top: 10px; color: #7f8c8d;">${variant.content}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Utility functions
        function showLoading() {
            document.getElementById('loading-indicator').style.display = 'block';
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
        }

        function hideLoading() {
            document.getElementById('loading-indicator').style.display = 'none';
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            document.getElementById(`${currentTab}-tab`).classList.add('active');
            document.getElementById(`${currentTab}-tab`).style.display = 'block';
        }

        function showNoData() {
            document.getElementById('loading-indicator').style.display = 'none';
            document.getElementById('no-data-message').style.display = 'block';
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
        }

        function refreshData() {
            loadTestData();
        }

        // Simulate API calls (replace with actual API calls)
        async function simulateAPICall(url, method = 'GET', data = null) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // Simulate API response
                    if (url === '/api/ab-tests') {
                        resolve({ tests: generateSampleTests() });
                    } else {
                        resolve({ success: true });
                    }
                }, 1000);
            });
        }

        // Generate sample test data for demonstration
        function generateSampleTests() {
            return [
                {
                    id: 'test_001',
                    name: 'Homepage Headline Test',
                    type: 'headline_testing',
                    status: 'running',
                    hypothesis: 'Emotional headlines will perform better than rational ones',
                    created_at: '2024-01-15T10:00:00Z',
                    start_date: '2024-01-16T09:00:00Z',
                    configuration: { sample_size: 1000, duration_days: 14 },
                    tracking: { total_impressions: 750, total_conversions: 45 },
                    variants: [
                        { id: 'var_001', name: 'Original', content: 'Professional HVAC Services' },
                        { id: 'var_002', name: 'Emotional', content: 'Transform Your Home Comfort Forever' }
                    ]
                },
                {
                    id: 'test_002',
                    name: 'CTA Button Test',
                    type: 'cta_testing',
                    status: 'stopped',
                    hypothesis: 'Action-oriented CTAs will improve click-through rates',
                    created_at: '2024-01-10T14:00:00Z',
                    start_date: '2024-01-11T09:00:00Z',
                    configuration: { sample_size: 500, duration_days: 7 },
                    tracking: { total_impressions: 500, total_conversions: 75 },
                    results: {
                        statistical_significance: true,
                        confidence_level: 95,
                        winner: { variant_name: 'Action CTA', conversion_rate: 18.5 },
                        lift_percentage: 12.3
                    },
                    variants: [
                        { id: 'var_003', name: 'Original', content: 'Learn More' },
                        { id: 'var_004', name: 'Action CTA', content: 'Get Expert Service Now' }
                    ]
                }
            ];
        }

        // Additional placeholder functions
        function viewTestHistory() {
            alert('Test history feature coming soon!');
        }

        function exportResults() {
            alert('Export feature coming soon!');
        }

        function editTest(testId) {
            alert('Edit test feature coming soon!');
        }

        function cloneTest(testId) {
            alert('Clone test feature coming soon!');
        }

        function archiveTest(testId) {
            alert('Archive test feature coming soon!');
        }

        function populateAnalytics() {
            // Analytics content is already set in the HTML
        }
    </script>
</body>
</html>