// CPL Brand Hub - Interactive JavaScript
// Embedded data for standalone operation

let activeMonth = 'december';
let activeFilter = 'all';

// Embedded dashboard data - REBALANCED (no weekends, better partner distribution)
const dashboardData = {"meta":{"lastUpdated":"2025-11-23","currentDate":"2025-11-23","criticalDeadline":"2025-11-25","danaEndDate":"2025-12-05"},"decisions":[{"id":1,"title":"Brand Architecture Revisions","description":"Approve revised positioning: removed 'boutique', renamed 'Honest' to 'Straightforward', added broker empowerment","status":"pending","deadline":"2025-11-25","approver":["Andrew","Alan"],"budgetImpact":"$0","priority":"critical"},{"id":2,"title":"Google Search Console Investment","description":"GSC setup + technical SEO fixes to enable content measurement and optimization","status":"pending","deadline":"2025-11-25","approver":["Andrew","Alan"],"budgetImpact":"$1,000-$1,500","priority":"critical"},{"id":3,"title":"Video Production Budget (Lexi Editing)","description":"Partner records 30-min Zoom call monthly → Lexi edits into 3-4 LinkedIn clips (30-60 sec each). Covers: video editing, captions, graphics, LinkedIn optimization. Ongoing monthly expense.","status":"pending","deadline":"2025-11-25","approver":["Andrew","Alan"],"budgetImpact":"$400-$950/month","priority":"critical","details":"Each partner: 1 recording/month = 3-4 posts. Total: ~12 video posts/month across all partners."},{"id":4,"title":"Q1 2026 Content Calendar","description":"Approve Dec-Feb publishing schedule (41 posts total)","status":"pending","deadline":"2025-11-25","approver":["Andrew","Alan"],"budgetImpact":"$0","priority":"high"},{"id":5,"title":"Partner Content Strategy","description":"Approve individual partner participation plans and content themes","status":"pending","deadline":"2025-11-25","approver":["Alex","Alan","Michael C","Michael R"],"budgetImpact":"$0","priority":"high"},{"id":6,"title":"Monthly Recording Commitment","description":"Each partner commits to 30-min Zoom recording per month","status":"pending","deadline":"2025-11-25","approver":["Alex","Alan","Michael C","Michael R"],"budgetImpact":"$0 (time commitment)","priority":"high"}],"calendar":{"december":[{"date":"2025-12-01","type":"firm-post","partner":"Dana","topic":"Meme: The Market Might Cool Off","platform":["LinkedIn","Instagram","TikTok","Facebook"],"status":"approved","format":"video","postingChannel":"Firm Profile (Andrew/CPL)"},{"date":"2025-12-03","type":"firm-post","partner":"Dana","topic":"Why Co-ops Don't Allow Interest-Only Loans","platform":["LinkedIn","Instagram","Facebook","TikTok"],"status":"approved","format":"text-video","postingChannel":"Firm Profile (Andrew/CPL)"},{"date":"2025-12-04","type":"firm-post","partner":"Dana","topic":"Keeping Transactions Professional","platform":["LinkedIn","Facebook","Instagram","TikTok"],"status":"approved","format":"video","postingChannel":"Firm Profile (Andrew/CPL)"},{"date":"2025-12-05","type":"firm-post","partner":"Dana","topic":"Understanding 'On or About' & 'Escrow'","platform":["LinkedIn","Instagram","TikTok","Facebook"],"status":"approved","format":"text","postingChannel":"Firm Profile (Andrew/CPL)"},{"date":"2025-12-09","type":"video","partner":"Alex Whiteaker","topic":"Orchestra Approach to Commercial RE","platform":["LinkedIn"],"status":"pending-recording","duration":"45s","recordingDate":"2025-11-27","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2025-12-11","type":"video","partner":"Alex Whiteaker","topic":"Year in Review: Memorable Collaboration","platform":["LinkedIn"],"status":"pending-recording","duration":"50s","recordingDate":"2025-11-27","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2025-12-13","type":"firm-post","partner":null,"topic":"5 Transaction Pitfalls from 2025","platform":["LinkedIn"],"status":"scheduled","format":"carousel","postingChannel":"Firm Profile Only"},{"date":"2025-12-15","type":"video","partner":"Alex Whiteaker","topic":"Navigating Year-End Urgency","platform":["LinkedIn"],"status":"pending-recording","duration":"40s","recordingDate":"2025-11-27","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2025-12-17","type":"video","partner":"Alan Perlowitz","topic":"Most Memorable Deal of 2025","platform":["LinkedIn"],"status":"pending-recording","duration":"55s","recordingDate":"2025-12-03","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2025-12-19","type":"blog","partner":"Alex Whiteaker","topic":"Orchestra Approach (Full Blog Post)","platform":["Blog","Newsletter"],"status":"pending-recording","format":"blog-post","postingChannel":"Website + Newsletter + LinkedIn Link"},{"date":"2025-12-22","type":"video","partner":"Alan Perlowitz","topic":"Year-End Tax Considerations","platform":["LinkedIn"],"status":"pending-recording","duration":"45s","recordingDate":"2025-12-03","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2025-12-26","type":"firm-post","partner":null,"topic":"Happy Holidays from CPL","platform":["LinkedIn"],"status":"scheduled","format":"image","postingChannel":"Firm Profile Only"},{"date":"2025-12-30","type":"video","partner":"Alan Perlowitz","topic":"Estate Planning Integration Example","platform":["LinkedIn"],"status":"pending-recording","duration":"50s","recordingDate":"2025-12-03","postingChannel":"Partner Profile → Firm Reposts"}],"january":[{"date":"2026-01-02","type":"firm-post","partner":null,"topic":"2026 Predictions: NYC RE Outlook","platform":["LinkedIn"],"status":"planned","format":"text","postingChannel":"Firm Profile Only"},{"date":"2026-01-06","type":"blog","partner":"Alan Perlowitz","topic":"Financial Expertise in Commercial RE","platform":["Blog","Newsletter"],"status":"planned","format":"blog-post","postingChannel":"Website + Newsletter + LinkedIn Link"},{"date":"2026-01-08","type":"firm-post","partner":null,"topic":"New NYC Mayor Impact on RE 2026","platform":["LinkedIn"],"status":"planned","format":"text","postingChannel":"Firm Profile Only"},{"date":"2026-01-10","type":"video","partner":"Alex Whiteaker","topic":"Q1 Commercial Market Outlook","platform":["LinkedIn"],"status":"planned","duration":"45s","recordingDate":"2026-01-06","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2026-01-13","type":"video","partner":"Alex Whiteaker","topic":"Financial Expertise in Action","platform":["LinkedIn"],"status":"planned","duration":"50s","recordingDate":"2026-01-06","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2026-01-15","type":"firm-post","partner":null,"topic":"Goal Setting for NYC Brokers 2026","platform":["LinkedIn"],"status":"planned","format":"carousel","postingChannel":"Firm Profile Only"}],"february":[{"date":"2026-02-03","type":"video","partner":"Michael Carlos","topic":"Transaction Tips for Spring Market","platform":["LinkedIn"],"status":"planned","duration":"40s","recordingDate":"2026-01-20","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2026-02-05","type":"firm-post","partner":null,"topic":"Black History Month: Diversity in NYC RE","platform":["LinkedIn"],"status":"planned","format":"text","postingChannel":"Firm Profile Only"},{"date":"2026-02-10","type":"video","partner":"Alex Whiteaker","topic":"Complex Deal from Challenging Circumstances","platform":["LinkedIn"],"status":"planned","duration":"55s","recordingDate":"2026-02-03","postingChannel":"Partner Profile → Firm Reposts"},{"date":"2026-02-12","type":"firm-post","partner":null,"topic":"Valentine's Day: Love Letter to Brokers","platform":["LinkedIn"],"status":"planned","format":"text","postingChannel":"Firm Profile Only"}]},"stats":{"totalPosts":41,"partnerVideos":28,"firmPosts":12,"blogPosts":3}};

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
    initializeDashboard();
});

function initializeDashboard() {
    // Update countdown
    updateDeadlineCountdown();

    // Populate sections
    populateCalendar();
    populateDecisions();

    // Setup interactions
    setupMonthTabs();
    setupFilters();
}

// Deadline Countdown
function updateDeadlineCountdown() {
    const deadline = new Date(dashboardData.meta.criticalDeadline);
    const now = new Date();
    const diff = deadline - now;

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

    const countdownEl = document.getElementById('deadlineCountdown');
    if (countdownEl) {
        if (days > 0) {
            countdownEl.textContent = `${days} days remaining`;
        } else if (hours > 0) {
            countdownEl.textContent = `${hours} hours remaining`;
        } else {
            countdownEl.textContent = 'DEADLINE PASSED';
        }
    }
}

// Populate Calendar
function populateCalendar() {
    const container = document.getElementById('calendarContainer');
    container.innerHTML = '';

    const monthData = dashboardData.calendar[activeMonth];
    if (!monthData) return;

    // Filter by active filter
    const filteredData = activeFilter === 'all'
        ? monthData
        : monthData.filter(item => item.type === activeFilter);

    // Get the first and last day of the month
    const firstDate = new Date(filteredData[0]?.date || `2025-${activeMonth === 'december' ? '12' : activeMonth === 'january' ? '01' : '02'}-01`);
    const year = firstDate.getFullYear();
    const month = firstDate.getMonth();

    // Create calendar grid
    const calendarGrid = document.createElement('div');
    calendarGrid.className = 'calendar-grid';

    // Add day headers
    const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    dayHeaders.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        calendarGrid.appendChild(header);
    });

    // Get first day of month and number of days
    const firstDayOfMonth = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    // Create map of dates to content
    const contentByDate = {};
    filteredData.forEach(item => {
        const date = new Date(item.date);
        const dayNum = date.getDate();
        if (!contentByDate[dayNum]) {
            contentByDate[dayNum] = [];
        }
        contentByDate[dayNum].push(item);
    });

    // Add empty cells for days before month starts
    for (let i = 0; i < firstDayOfMonth; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day empty';
        calendarGrid.appendChild(emptyCell);
    }

    // Add days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-day';

        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        dayCell.appendChild(dayNumber);

        // Add content for this day if exists
        if (contentByDate[day]) {
            dayCell.classList.add('has-content');

            contentByDate[day].forEach(item => {
                const contentItem = document.createElement('div');
                contentItem.className = `calendar-content-item ${item.type}`;
                contentItem.innerHTML = `
                    <div class="content-type-badge">${item.type.replace('-', ' ')}</div>
                    <div class="content-topic">${item.topic}</div>
                    <div class="content-meta">
                        ${item.partner ? `<div class="content-partner">${item.partner}</div>` : '<div class="content-partner">CPL Firm</div>'}
                        ${item.postingChannel ? `<div class="content-channel">${item.postingChannel}</div>` : ''}
                    </div>
                `;

                // Make clickable for details
                contentItem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showContentDetails(item);
                });

                dayCell.appendChild(contentItem);
            });
        }

        calendarGrid.appendChild(dayCell);
    }

    container.appendChild(calendarGrid);
}

// Show content details in modal/expanded view
function showContentDetails(item) {
    const modal = document.createElement('div');
    modal.className = 'content-modal';
    modal.innerHTML = `
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <button class="modal-close">&times;</button>
            <h3>${item.topic}</h3>
            <div class="modal-details">
                <div class="detail-row">
                    <span class="detail-label">Date:</span>
                    <span class="detail-value">${new Date(item.date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Type:</span>
                    <span class="detail-value">${item.type.replace('-', ' ').toUpperCase()}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value">${item.status.replace('-', ' ').toUpperCase()}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Platform:</span>
                    <span class="detail-value">${item.platform.join(', ')}</span>
                </div>
                ${item.partner ? `
                <div class="detail-row">
                    <span class="detail-label">Partner:</span>
                    <span class="detail-value">${item.partner}</span>
                </div>
                ` : ''}
                ${item.postingChannel ? `
                <div class="detail-row">
                    <span class="detail-label">Posting Channel:</span>
                    <span class="detail-value">${item.postingChannel}</span>
                </div>
                ` : ''}
                ${item.duration ? `
                <div class="detail-row">
                    <span class="detail-label">Duration:</span>
                    <span class="detail-value">${item.duration}</span>
                </div>
                ` : ''}
                ${item.recordingDate ? `
                <div class="detail-row">
                    <span class="detail-label">Recording Date:</span>
                    <span class="detail-value">${new Date(item.recordingDate).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</span>
                </div>
                ` : ''}
                ${item.format ? `
                <div class="detail-row">
                    <span class="detail-label">Format:</span>
                    <span class="detail-value">${item.format.replace('-', ' ').toUpperCase()}</span>
                </div>
                ` : ''}
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    // Close modal handlers
    modal.querySelector('.modal-close').addEventListener('click', () => modal.remove());
    modal.querySelector('.modal-overlay').addEventListener('click', () => modal.remove());
}

// Populate Decisions
function populateDecisions() {
    const container = document.getElementById('decisionsGrid');
    container.innerHTML = '';

    dashboardData.decisions.forEach(decision => {
        const card = document.createElement('div');
        card.className = 'decision-card';

        card.innerHTML = `
            <div class="decision-header">
                <div class="decision-number">Decision #${decision.id}</div>
                <div class="decision-status">${decision.status.toUpperCase()}</div>
            </div>
            <h3 class="decision-title">${decision.title}</h3>
            <p class="decision-description">${decision.description}</p>
            <div class="decision-meta">
                <div class="decision-budget">${decision.budgetImpact}</div>
                <div class="decision-approvers">${decision.approver.join(', ')}</div>
            </div>
        `;

        container.appendChild(card);
    });
}

// Setup Month Tabs
function setupMonthTabs() {
    document.querySelectorAll('.month-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            // Update active tab
            document.querySelectorAll('.month-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');

            // Update active month
            activeMonth = tab.dataset.month;

            // Repopulate calendar
            populateCalendar();
        });
    });
}

// Setup Filters
function setupFilters() {
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            // Update active filter
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            // Update active filter
            activeFilter = btn.dataset.filter;

            // Repopulate calendar
            populateCalendar();
        });
    });
}

// Update last updated date
const lastUpdatedEl = document.getElementById('lastUpdated');
if (lastUpdatedEl) {
    lastUpdatedEl.textContent = dashboardData.meta.lastUpdated;
}
