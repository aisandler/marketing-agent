<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Command Center</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            deep: '#0a0b10',
            panel: '#1f2128',
            accent: '#FF6600',
            glow: '#7B61FF',
            'border-dim': '#333333',
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
        }
      }
    }
  </script>

  <!-- CDN: Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>

  <!-- CDN: Syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark-dimmed.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <!-- CDN: CodeMirror (code file editor) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/theme/material-darker.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/markdown/markdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/yaml/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/shell/shell.min.js"></script>

  <!-- CDN: Toast UI Editor (WYSIWYG markdown) -->
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css">
  <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/theme/toastui-editor-dark.min.css">
  <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

  <style>
    /* === Reset === */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* === Scrollbar === */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.14); }

    /* === Glass Panel === */
    .glass-panel {
      background: rgba(26,27,32,0.75);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: 0 4px 24px rgba(0,0,0,0.25), 0 0 0 1px rgba(255,255,255,0.03) inset;
    }

    /* === Dot Grid Background === */
    .dot-grid {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.06) 1px, transparent 0);
      background-size: 28px 28px;
      pointer-events: none;
      z-index: 0;
    }

    /* === Glowing Orbs === */
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(120px);
      pointer-events: none;
      z-index: 0;
    }
    .orb-purple {
      width: 600px;
      height: 600px;
      background: rgba(123,97,255,0.10);
      top: -10%;
      left: -8%;
    }
    .orb-orange {
      width: 500px;
      height: 500px;
      background: rgba(255,102,0,0.07);
      bottom: -15%;
      right: -3%;
    }

    /* === Agent Flyout Transition === */
    .agent-flyout {
      transform: translateX(-100%);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.28s cubic-bezier(0.16,1,0.3,1), opacity 0.2s cubic-bezier(0.16,1,0.3,1);
      box-shadow: 6px 0 24px rgba(0,0,0,0.4);
    }
    .agent-flyout.open {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }
    .agent-flyout ~ main {
      transition: margin-left 0.28s cubic-bezier(0.16,1,0.3,1);
    }
    .agent-flyout.open ~ main {
      margin-left: 280px;
    }

    /* === Workspace Panel Show/Hide === */
    .workspace-operations,
    .workspace-context,
    .workspace-studio,
    .workspace-files,
    .workspace-activity,
    .workspace-settings {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.22s cubic-bezier(0.16,1,0.3,1), visibility 0.22s;
    }
    .workspace-operations.active,
    .workspace-context.active,
    .workspace-studio.active,
    .workspace-files.active,
    .workspace-activity.active,
    .workspace-settings.active {
      opacity: 1;
      visibility: visible;
    }

    /* === Agent Token Animations === */
    .agent-token.thinking {
      animation: tokenSpin 2.4s cubic-bezier(0.4,0,0.2,1) infinite, tokenPulse 1.6s ease-in-out infinite;
    }
    .streaming-msg .agent-token {
      animation: tokenPulse 2s ease-in-out infinite;
    }

    /* === Streaming Cursor === */
    .streaming-cursor::after {
      content: '\2588';
      color: #7B61FF;
      animation: blink 0.8s infinite;
    }

    /* === Tool Body Expand/Collapse === */
    .tool-body { display: none; }
    .tool-body.expanded { display: block; }

    /* === Tool Status Badges === */
    .tool-status.running { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .tool-status.done    { background: rgba(16,185,129,0.15); color: #10b981; }
    .tool-status.error   { background: rgba(239,68,68,0.15); color: #ef4444; }

    /* === Session Dot Status Colors === */
    .session-dot.running          { background: #10b981; box-shadow: 0 0 6px #10b981; }
    .session-dot.starting         { background: #f59e0b; }
    .session-dot.waiting_permission { background: #f59e0b; }
    .session-dot.idle             { background: #3b82f6; }
    .session-dot.completed        { background: rgba(255,255,255,0.35); }
    .session-dot.error            { background: #ef4444; }

    /* === Live Dot Status === */
    .live-dot.running   { background: #10b981; box-shadow: 0 0 6px #10b981; }
    .live-dot.starting  { background: #f59e0b; }
    .live-dot.waiting_permission { background: #f59e0b; }
    .live-dot.idle      { background: #3b82f6; }
    .live-dot.completed { background: rgba(255,255,255,0.35); }
    .live-dot.error     { background: #ef4444; }

    /* === Ask Option States === */
    .ask-option.selected {
      border-color: #FF6600 !important;
      background: rgba(255,102,0,0.08) !important;
    }
    .ask-option.selected::before { opacity: 1; }

    /* === Quick Reply States === */
    .qr-btn.sent {
      opacity: 0.4;
      pointer-events: none;
      border-color: rgba(255,255,255,0.07) !important;
    }
    .qr-btn.sent-active {
      opacity: 0.7;
      pointer-events: none;
      border-color: #10b981 !important;
      background: rgba(16,185,129,0.08) !important;
    }
    .qr-btn.sent-active::after {
      content: 'Sent';
      position: absolute;
      top: 6px;
      right: 8px;
      font-size: 10px;
      font-weight: 600;
      color: #10b981;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* === Context Badge Colors === */
    .ctx-badge.fresh { background: rgba(16,185,129,0.15); color: #10b981; }
    .ctx-badge.stale { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .ctx-badge.old   { background: rgba(239,68,68,0.15); color: #ef4444; }
    .ctx-badge.never { background: #08090C; color: rgba(255,255,255,0.35); }
    .ctx-badge.yes, .ctx-badge.ok { background: rgba(16,185,129,0.15); color: #10b981; }
    .ctx-badge.no, .ctx-badge.missing { background: rgba(239,68,68,0.15); color: #ef4444; }

    /* === Settings Status Badges === */
    .settings-status.configured { background: rgba(16,185,129,0.15); color: #10b981; }
    .settings-status.missing    { background: rgba(239,68,68,0.15); color: #ef4444; }
    .settings-status.optional   { background: #08090C; color: rgba(255,255,255,0.35); }

    /* === Sub-Agent Slide-Over === */
    .sub-slide {
      position: fixed;
      top: 0;
      right: -500px;
      width: 500px;
      height: 100vh;
      background: #0a0b10;
      border-left: 1px solid #333;
      z-index: 100;
      display: flex;
      flex-direction: column;
      transition: right 0.3s cubic-bezier(0.16,1,0.3,1);
      box-shadow: -8px 0 24px rgba(0,0,0,0.3);
    }
    .sub-slide.open { right: 0; }

    /* === Sub-Agent Card Status === */
    .subagent-status.running   { background: rgba(16,185,129,0.15); color: #10b981; }
    .subagent-status.starting  { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .subagent-status.completed { background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.35); }
    .subagent-status.error     { background: rgba(239,68,68,0.15); color: #ef4444; }

    /* === Sub-Agent Token Status Rings === */
    .subagent-token::after {
      content: '';
      position: absolute;
      inset: -3px;
      border-radius: 50%;
      border: 2px solid transparent;
      transition: border-color 0.2s;
    }
    .subagent-card.running .subagent-token::after   { border-color: #10b981; }
    .subagent-card.starting .subagent-token::after   { border-color: #f59e0b; border-style: dashed; }
    .subagent-card.completed .subagent-token::after  { border-color: rgba(255,255,255,0.35); }
    .subagent-card.error .subagent-token::after      { border-color: #ef4444; }

    /* === Orchestration Panel === */
    .orchestration-panel { display: none; }
    .orchestration-panel.active { display: block; }

    /* === Command Palette Modal === */
    .command-palette-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index: 200;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 20vh;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s, visibility 0.2s;
    }
    .command-palette-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    /* === CodeMirror Overrides === */
    .CodeMirror {
      height: 100% !important;
      font-family: 'SF Mono', 'Cascadia Code', 'Fira Code', monospace;
      font-size: 13px;
      line-height: 1.5;
      background: #0a0b10 !important;
    }
    .CodeMirror-gutters {
      background: #0a0b10 !important;
      border-right: 1px solid rgba(255,255,255,0.05) !important;
    }

    /* === Keyframe Animations === */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideIn {
      from { transform: translateX(20px); opacity: 0; }
      to   { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
      to { opacity: 0; }
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50%      { opacity: 0; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50%      { opacity: 0.4; }
    }
    @keyframes shimmer {
      0%   { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    @keyframes thinking-bounce {
      0%, 80%, 100% { transform: scale(0.4); opacity: 0.3; }
      40% { transform: scale(1); opacity: 0.8; }
    }
    @keyframes agentSpawnPulse {
      0%  { transform: scale(0.6); opacity: 0; box-shadow: 0 0 0 0 var(--spawn-color, #7B61FF); }
      50% { transform: scale(1.05); opacity: 1; box-shadow: 0 0 20px 4px var(--spawn-color, #7B61FF); }
      100%{ transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 transparent; }
    }
    @keyframes agentSpawnDrift {
      0%   { transform: translateY(8px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    @keyframes agentSpawnGlow {
      0%   { filter: brightness(1.0); }
      40%  { filter: brightness(1.6); }
      100% { filter: brightness(1.0); }
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @keyframes tokenSpin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes tokenPulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 16px var(--token-glow, rgba(123,97,255,0.3)); }
      50%      { opacity: 0.7; box-shadow: 0 0 28px var(--token-glow, rgba(123,97,255,0.5)); }
    }

    /* === Applied Animations === */
    .message { animation: fadeIn 0.2s cubic-bezier(0.16,1,0.3,1); }
    .toast   { animation: slideIn 0.3s cubic-bezier(0.16,1,0.3,1), fadeOut 0.3s ease 3s; animation-fill-mode: forwards; }
    .skeleton {
      background: linear-gradient(90deg, #0a0b10 25%, #1a1a22 50%, #0a0b10 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }
    .thinking-dots span {
      animation: thinking-bounce 1.4s infinite ease-in-out both;
    }
    .thinking-dots span:nth-child(2) { animation-delay: 0.16s; }
    .thinking-dots span:nth-child(3) { animation-delay: 0.32s; }
    .live-dot.running, .live-dot.starting { animation: pulse 1.5s infinite; }
    .session-dot.running, .session-dot.starting { animation: pulse 1.5s infinite; }
    .subagent-card.agent-spawn {
      animation: agentSpawnPulse 0.6s cubic-bezier(0.16,1,0.3,1),
                 agentSpawnDrift 0.4s cubic-bezier(0.16,1,0.3,1) 0.1s both,
                 agentSpawnGlow 0.8s cubic-bezier(0.16,1,0.3,1);
    }
    .permission-card { animation: fadeIn 0.3s cubic-bezier(0.16,1,0.3,1); }
    .team-group .agent-card { animation: fadeIn 0.2s cubic-bezier(0.16,1,0.3,1) both; }

    /* === Rail Button Active Indicator === */
    .rail-btn.active {
      box-shadow: inset 2px 0 0 #7B61FF;
    }

    /* === Markdown Content Styling === */
    .msg-content h1, .msg-content h2, .msg-content h3 {
      margin: 16px 0 4px;
      color: #f5f5f7;
      font-family: 'Inter', sans-serif;
    }
    .msg-content h1 { font-size: 16px; font-weight: 700; }
    .msg-content h2 { font-size: 15px; font-weight: 600; }
    .msg-content h3 { font-size: 14px; font-weight: 600; }
    .msg-content p { margin: 6px 0; }
    .msg-content ul, .msg-content ol { margin: 6px 0; padding-left: 20px; }
    .msg-content li { margin: 2px 0; }
    .msg-content code {
      background: #08090C;
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 12px;
      font-family: 'SF Mono', 'Cascadia Code', monospace;
    }
    .msg-content pre {
      background: #08090C;
      padding: 8px 16px;
      border-radius: 6px;
      overflow-x: auto;
      margin: 8px 0;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .msg-content pre code { background: none; padding: 0; font-size: 12px; }
    .msg-content a { color: #FF6600; text-decoration: none; }
    .msg-content a:hover { text-decoration: underline; }
    .msg-content blockquote {
      border-left: 3px solid rgba(255,255,255,0.14);
      padding-left: 16px;
      margin: 8px 0;
      color: rgba(255,255,255,0.50);
    }
    .msg-content table { border-collapse: collapse; margin: 8px 0; font-size: 12px; }
    .msg-content th, .msg-content td { border: 1px solid rgba(255,255,255,0.07); padding: 4px 8px; }
    .msg-content th { background: #08090C; }

    /* === Conic Health Ring (dashboard) === */
    .health-ring-conic {
      background: conic-gradient(var(--health-color, #10b981) var(--health-pct, 0%), rgba(255,255,255,0.06) 0);
      border-radius: 50%;
      padding: 6px;
    }
    .health-ring-inner {
      background: #1A1B20;
      border-radius: 50%;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    /* === File Tree Depth Indentation === */
    .file-tree-item {
      padding-left: calc(8px + var(--depth, 0) * 16px);
    }
    .tree-arrow.open { transform: rotate(90deg); }

    /* === Ambient Vignette === */
    .vignette {
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.35) 100%);
      pointer-events: none;
      z-index: 0;
    }

    /* === Toast UI Editor Dark Overrides === */
    .toastui-editor-defaultUI {
      border: none !important;
      background: transparent !important;
    }
    .toastui-editor-defaultUI .toastui-editor-toolbar {
      background: rgba(10,11,16,0.80) !important;
      border-bottom: 1px solid rgba(255,255,255,0.06) !important;
    }
    .toastui-editor-defaultUI .toastui-editor-mode-switch {
      display: none !important;
    }
    .toastui-editor-contents,
    .toastui-editor-ww-container {
      background: #0a0b10 !important;
    }
    .toastui-editor-contents p,
    .toastui-editor-contents li,
    .toastui-editor-contents td,
    .toastui-editor-contents th {
      color: #d1d5db !important;
    }
    .toastui-editor-contents h1,
    .toastui-editor-contents h2,
    .toastui-editor-contents h3,
    .toastui-editor-contents h4 {
      color: #f5f5f7 !important;
      border-bottom-color: rgba(255,255,255,0.06) !important;
    }
    .toastui-editor-contents code {
      background: rgba(255,255,255,0.06) !important;
      color: #e5e7eb !important;
    }
    .toastui-editor-contents pre {
      background: #08090C !important;
      border: 1px solid rgba(255,255,255,0.04) !important;
    }
    .toastui-editor-contents blockquote {
      border-left-color: rgba(255,255,255,0.14) !important;
      color: rgba(255,255,255,0.50) !important;
    }
    .toastui-editor-contents a {
      color: #FF6600 !important;
    }
    .toastui-editor-contents table td,
    .toastui-editor-contents table th {
      border-color: rgba(255,255,255,0.07) !important;
    }
    .toastui-editor-contents table th {
      background: #08090C !important;
    }
    .ProseMirror {
      padding: 16px 20px !important;
    }

    /* === Reduced Motion === */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* === Responsive === */
    @media (max-width: 1100px) {
      .right-panel { display: none !important; }
    }
    @media (max-width: 768px) {
      .left-nav { display: none !important; }
    }
  </style>
</head>
<body class="h-screen flex text-sm antialiased bg-[#08090C] font-sans text-gray-200 overflow-hidden">

<!-- Toast container -->
<div id="toasts" class="fixed top-4 right-4 z-[100] flex flex-col gap-1.5"></div>

<div class="flex w-full h-full relative z-10">

  <!-- ===== Left Nav (70px) ===== -->
  <nav class="left-nav w-[70px] bg-deep border-r border-border-dim flex flex-col items-center py-6 flex-shrink-0 z-20">

    <!-- New session button -->
    <button class="w-10 h-10 rounded-lg bg-accent/10 border border-accent/20 flex items-center justify-center text-accent hover:bg-accent/20 transition-colors mb-6 cursor-pointer" onclick="window.CC?.toggleFlyout(true)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    </button>

    <!-- Workspace icons -->
    <div class="flex flex-col items-center gap-1">
      <button class="rail-btn w-9 h-9 flex items-center justify-center rounded-md cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all relative active" data-workspace="operations" title="Operations">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
          <line x1="12" y1="2" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="22"/>
          <line x1="2" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="22" y2="12"/>
        </svg>
      </button>

      <button class="rail-btn w-9 h-9 flex items-center justify-center rounded-md cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all relative" data-workspace="context" title="Context">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
        </svg>
      </button>

      <button class="rail-btn w-9 h-9 flex items-center justify-center rounded-md cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all relative" data-workspace="studio" title="Studio">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/>
        </svg>
      </button>

      <button class="rail-btn w-9 h-9 flex items-center justify-center rounded-md cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all relative" data-workspace="files" title="Files">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
        </svg>
      </button>

      <button class="rail-btn w-9 h-9 flex items-center justify-center rounded-md cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all relative" data-workspace="activity" title="Activity">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
        </svg>
      </button>

      <button class="rail-btn w-9 h-9 flex items-center justify-center rounded-md cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all relative" data-workspace="settings" title="Settings">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"/>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
        </svg>
      </button>
    </div>

    <!-- Spacer -->
    <div class="flex-1"></div>

    <!-- Divider -->
    <div class="w-5 h-px bg-border-dim my-2"></div>

    <!-- Agent flyout toggle -->
    <button class="rail-btn w-9 h-9 flex items-center justify-center rounded-md cursor-pointer text-gray-500 hover:text-gray-300 hover:bg-white/5 transition-all relative" id="agentFlyoutToggle" title="Agents">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    </button>

    <!-- User avatar -->
    <div class="w-8 h-8 rounded-full bg-panel mt-4 flex items-center justify-center text-[10px] text-gray-600 font-bold border border-white/5">
      U
    </div>
  </nav>

  <!-- ===== Agent Flyout Panel ===== -->
  <aside class="agent-flyout fixed top-0 left-[70px] bottom-0 w-[280px] bg-[#14151a] border-r border-border-dim z-30 flex flex-col" id="agentFlyout">
    <div class="px-4 py-4 border-b border-white/5 flex items-center justify-between flex-shrink-0">
      <span class="text-[10px] font-bold tracking-[0.15em] uppercase text-gray-500">Agents</span>
      <button class="w-6 h-6 flex items-center justify-center rounded text-gray-500 hover:text-white hover:bg-white/5 cursor-pointer transition-colors border-0 bg-transparent text-sm" onclick="CC.toggleFlyout(false)">&times;</button>
    </div>
    <div class="flex-1 overflow-y-auto p-2">
      <div id="quickAgents" class="quick-agents flex gap-2 mb-3 px-1"></div>
      <div id="teamList"></div>
    </div>
    <div class="border-t border-white/5 flex-shrink-0 max-h-[180px] overflow-y-auto p-2" id="liveCards"></div>
  </aside>

  <!-- ===== Center Area ===== -->
  <main class="flex-1 flex flex-col relative overflow-hidden">

    <!-- Background effects -->
    <div class="dot-grid"></div>
    <div class="orb orb-purple"></div>
    <div class="orb orb-orange"></div>
    <div class="vignette"></div>

    <!-- Header bar with session tabs -->
    <div class="flex items-center px-6 py-3 border-b border-white/5 z-20 flex-shrink-0" style="background:rgba(10,11,16,0.70);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px)">
      <div class="flex items-center gap-4 flex-1 min-w-0">
        <h1 class="text-xs font-bold tracking-[0.2em] uppercase text-accent flex-shrink-0">Command Center</h1>
        <div id="sessionTabs" class="flex gap-2 overflow-x-auto min-w-0"></div>
      </div>
    </div>

    <!-- Workspace content (stacked panels) -->
    <div class="flex-1 relative overflow-hidden">

      <!-- Operations: Chat + Orchestration -->
      <div class="workspace-operations active absolute inset-0 flex flex-col overflow-hidden">
        <div class="flex flex-1 overflow-hidden">
          <div id="chatArea" class="flex-1 overflow-y-auto p-8 pb-36 flex flex-col gap-6 scroll-smooth z-10 relative">
            <div class="empty-state flex-1 flex flex-col items-center justify-center gap-4 text-gray-500">
              <div class="text-5xl font-bold bg-gradient-to-r from-glow to-accent bg-clip-text text-transparent">Command Center</div>
              <div class="flex gap-1.5">
                <span class="w-2 h-2 rounded-sm bg-orange-500 shadow-[0_0_8px_currentColor]"></span>
                <span class="w-2 h-2 rounded-sm bg-violet-500 shadow-[0_0_8px_currentColor]"></span>
                <span class="w-2 h-2 rounded-sm bg-blue-500 shadow-[0_0_8px_currentColor]"></span>
                <span class="w-2 h-2 rounded-sm bg-emerald-500 shadow-[0_0_8px_currentColor]"></span>
              </div>
              <p class="text-sm max-w-md text-center leading-relaxed">Select an agent from the sidebar or press <kbd class="px-1.5 py-0.5 bg-white/5 rounded text-[11px] border border-white/10">A</kbd> to open the agent panel.</p>
            </div>
          </div>
          <div id="orchestrationPanel" class="orchestration-panel w-[260px] border-l border-white/5 bg-deep overflow-y-auto p-2"></div>
        </div>
      </div>

      <!-- Context Dashboard -->
      <div class="workspace-context absolute inset-0 flex flex-col overflow-hidden">
        <div id="contextDashboard" class="flex-1 overflow-y-auto p-6"></div>
      </div>

      <!-- Image Studio -->
      <div class="workspace-studio absolute inset-0 flex flex-col overflow-hidden">
        <div id="imageStudio" class="flex-1 overflow-y-auto p-6"></div>
      </div>

      <!-- File Browser -->
      <div class="workspace-files absolute inset-0 flex overflow-hidden">
        <div class="w-60 bg-deep border-r border-white/5 flex flex-col overflow-hidden flex-shrink-0">
          <div class="px-4 py-3 text-[10px] font-bold tracking-[0.15em] uppercase text-gray-500 border-b border-white/5">Files</div>
          <div id="fileTree" class="flex-1 overflow-y-auto py-1"></div>
        </div>
        <div id="fileEditor" class="flex-1 flex flex-col overflow-hidden">
          <div class="flex items-center gap-2 px-4 py-2 border-b border-white/5 bg-deep text-xs">
            <span id="filePath" class="flex-1 text-gray-500 font-mono truncate text-xs">No file open</span>
            <span id="fileSize" class="text-gray-600 text-[10px]"></span>
            <span id="fileDirtyBadge" class="text-amber-400 text-[10px] font-bold" style="display:none">Modified</span>
            <button id="btnSave" class="px-3 py-1 text-[11px] font-bold bg-gradient-to-r from-glow to-cyan-500 text-white rounded-md cursor-pointer border-0" style="display:none" onclick="CC.saveFile()">Save</button>
          </div>
          <div id="editorContent" class="flex-1 overflow-hidden relative">
            <div class="flex items-center justify-center h-full text-gray-600 text-sm">Select a file from the tree to view or edit.</div>
          </div>
        </div>
      </div>

      <!-- Activity -->
      <div class="workspace-activity absolute inset-0 flex flex-col overflow-hidden">
        <div id="activityView" class="flex-1 overflow-y-auto p-6"></div>
      </div>

      <!-- Settings -->
      <div class="workspace-settings absolute inset-0 flex flex-col overflow-hidden">
        <div id="settingsView" class="flex-1 overflow-y-auto p-6 max-w-3xl"></div>
      </div>

    </div>

    <!-- ===== Input Bar (floating) ===== -->
    <div class="input-bar absolute bottom-6 left-0 right-0 px-8 z-20">
      <div class="max-w-4xl mx-auto">
        <div class="relative flex items-center rounded-xl p-2 border border-white/10 shadow-2xl" style="background:rgba(31,33,40,0.80);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);box-shadow:0 8px 32px rgba(0,0,0,0.4),0 0 0 1px rgba(255,255,255,0.05) inset">
          <textarea id="inputText" class="flex-1 bg-transparent border-0 outline-none text-gray-200 text-sm font-sans leading-relaxed resize-none min-h-[40px] max-h-[120px] px-3 py-2 placeholder:text-gray-600" rows="1" placeholder="Select an agent to begin..." disabled></textarea>
          <button id="btnSend" class="w-9 h-9 rounded-lg bg-accent flex items-center justify-center text-white cursor-pointer border-0 hover:brightness-110 transition-all disabled:opacity-30 disabled:cursor-not-allowed flex-shrink-0 ml-1" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
          <button id="btnStop" class="w-9 h-9 rounded-lg bg-red-500/15 flex items-center justify-center text-red-400 cursor-pointer border-0 hover:bg-red-500/25 transition-all flex-shrink-0 ml-1" style="display:none">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="6" y="6" width="12" height="12" rx="1"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

  </main>

  <!-- ===== Right Panel (320px) â€” Context Intelligence ===== -->
  <aside class="right-panel w-80 bg-[#14151a] border-l border-border-dim flex flex-col z-20 flex-shrink-0 overflow-y-auto">
    <div class="px-5 py-4 border-b border-white/5 flex-shrink-0">
      <h2 class="text-[10px] font-bold tracking-[0.2em] uppercase text-gray-500">Context Intelligence</h2>
    </div>

    <!-- Health Gauge -->
    <div class="px-5 py-4 flex justify-center" id="ctxHealthGauge"></div>

    <!-- Onboarded Badge -->
    <div class="px-5 pb-3" id="ctxOnboarded"></div>

    <!-- Intelligence -->
    <div class="px-5 py-3">
      <div class="text-[10px] font-bold tracking-[0.15em] uppercase text-gray-500 mb-3">Active Streams</div>
      <div id="ctxIntel" class="flex flex-col gap-1"></div>
    </div>

    <!-- Context Files -->
    <div class="px-5 py-3">
      <div class="text-[10px] font-bold tracking-[0.15em] uppercase text-gray-500 mb-3">Context Files</div>
      <div id="ctxFiles" class="flex flex-col gap-1"></div>
    </div>

    <!-- Session Stats -->
    <div class="px-5 py-3 mt-auto border-t border-white/5">
      <div class="text-[10px] font-bold tracking-[0.15em] uppercase text-gray-500 mb-3">Session</div>
      <div id="ctxStats" class="flex flex-col gap-1"></div>
    </div>
  </aside>

</div>

<!-- Bootstrap modules -->
<script type="module" src="modules/init.js"></script>

</body>
</html>
